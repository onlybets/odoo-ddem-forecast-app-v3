<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Import Odoo CSTD Forecast</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⬇️</text></svg>" type="image/svg+xml">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>
<body>
  <div class="container mt-5">
    <a href="index.html" class="btn btn-secondary mb-3">Back to Home</a>
    <h2>Import Odoo CSTD forecast data JSON</h2>
    <div class="form-group">
      <label for="importJsonFile">Selsect a json file to import:</label>
      <input type="file" id="importJsonFile" accept=".json" class="form-control">
    </div>
    <button id="importJsonBtn" class="btn btn-primary">Import data</button>
  </div>

  <script>
    $('#importJsonBtn').click(function() {
      const fileInput = document.getElementById('importJsonFile');
      if (!fileInput || fileInput.files.length === 0) {
        Toastify({
          text: "please select file",
          duration: 3000,
          gravity: "top",
          position: "right",
          backgroundColor: "#f44336"
        }).showToast();
        return;
      }
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          // Vérifie que la structure est correcte
          if (!data.clients || !data.upsells || !data.successPacks || !data.renews || !data.targets || !data.settings) {
            throw new Error("invalide data structure");
          }
          // Enregistre les données dans localStorage
          localStorage.setItem('clients', JSON.stringify(data.clients));
          localStorage.setItem('upsells', JSON.stringify(data.upsells));
          localStorage.setItem('successPacks', JSON.stringify(data.successPacks));
          localStorage.setItem('renews', JSON.stringify(data.renews));
          localStorage.setItem('targets', JSON.stringify(data.targets));
          localStorage.setItem('settings', JSON.stringify(data.settings));
          Toastify({
            text: "Successfully imported data",
            duration: 5000,
            gravity: "top",
            position: "right",
            backgroundColor: "#4caf50"
          }).showToast();
        } catch (err) {
          Toastify({
            text: "Erreur lors de l'importation : " + err.message,
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "#f44336"
          }).showToast();
        }
      };
      reader.readAsText(file);
    });
  </script>
</body>
</html>